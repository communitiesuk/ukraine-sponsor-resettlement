---
defaults: &defaults
  buildpacks:
    - https://github.com/cloudfoundry/ruby-buildpack.git
  command: bundle exec rake cf:on_first_instance db:migrate && bin/rails server
  instances: 2
  memory: 512M
  health-check-type: http
  health-check-http-endpoint: /health

applications:
  - name: ukraine-sponsor-resettlement-test
    <<: *defaults
    env:
      RAILS_ENV: test
      INSTANCE_NAME: ukraine-sponsor-resettlement-test
    services:
      - ukraine-sponsor-resettlement-test-postgres
      - ukraine-sponsor-resettlement-test-s3

  - name: ukraine-sponsor-resettlement-staging
    <<: *defaults
    env:
      RAILS_ENV: staging
      INSTANCE_NAME: ukraine-sponsor-resettlement-staging
    services:
      - ukraine-sponsor-resettlement-staging-postgres
      - ukraine-sponsor-resettlement-staging-redis
      - ukraine-sponsor-resettlement-staging-s3

  - name: ukraine-sponsor-resettlement-production
    <<: *defaults
    env:
      RAILS_ENV: production
      INSTANCE_NAME: ukraine-sponsor-resettlement-production
    instances: 4
    memory: 512M
    services:
      - ukraine-sponsor-resettlement-production-postgres
      - ukraine-sponsor-resettlement-production-redis
      - ukraine-sponsor-resettlement-production-s3
